<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        *{
            padding: 0;
            margin: 0;
        }
        body {
            background-color: #000000;
        }
        button {
            float: left;
        }

        #pdf {
            position: absolute;
            margin: 50px;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            display: none;
            background-color: #ffffff;
        }
        canvas {
            width: 100%;
        }
    </style>
</head>
<body>
<button id="btn">按钮</button>
<button id="btn2">按钮</button>
<div id="pdf"></div>

<script src="js/pdf.js"></script>
<script src="js/jquery.js"></script>
<script>

    let url = 'PDF.pdf';

    pdfjsLib.getDocument(url).then(function (pdf) {
        console.log(pdf);
        let numPages = pdf.numPages;
        let start = 1;
        // renderPage(pdf, numPages, start);
        for (let i = 0; i < pdf.numPages; i++) {
            pdf.getPage(i + 1).then(function (page) {
                console.log(page);
                let viewport = page.getViewport(1);
                let canvas = document.createElement('canvas');
                let context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                let renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                page.render(renderContext);
                document.getElementById('pdf').appendChild(canvas);

                // console.log(canvas.toDataURL('image/png'));
                // let image = new Image();
                // image.src = canvas.toDataURL('image/png');
                // document.body.appendChild(image);
            });
        }
    });

    function renderPage(pdf, numPages, current){
        console.log("renderPage");
        pdf.getPage(current++).then(page=>{
            //console.log('page', page);
            //page.getTextContent().then(v=>console.log(v));
            var scale = 1.5;
            var viewport = page.getViewport(scale);
            // Prepare canvas using PDF page dimensions.
            var canvas = document.createElement("canvas");
            var context = canvas.getContext('2d');
            document.body.appendChild(canvas);

            canvas.height = viewport.height;
            canvas.width = viewport.width;

            // Render PDF page into canvas context.
            var renderContext = {
                canvasContext: context,
                viewport: viewport
            };
            page.render(renderContext);

            let img = new Image();
            img.src = canvas.toDataURL('image/png');
            document.body.appendChild(img);

            //next
            if(current<=numPages)return renderPage(pdf, numPages, current);
        });
    }

    $('#btn').click(function () {
        $('#pdf').toggle();
    });

    $('#btn2').click(function () {

        let canvas = $('canvas')[0];

        let img = new Image();
        img.src = canvas.toDataURL('image/png');
        document.body.appendChild(img);
    });


</script>
</body>
</html>