<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 8vw;
            background-color: #ffffff;
        }

        body {
            padding: 0.5rem;
        }

        #page1 {
            display: block;
        }

        .page {
            display: none;
        }

        #header {
            background-color: #ffffff;
            width: 100%;
            height: 1.466rem;
            display: flex;
            margin-bottom: 0.666rem;
            -webkit-border-radius: 0.266rem;
            -moz-border-radius: 0.266rem;
            border-radius: 0.266rem;
            box-shadow: 0 0.1rem 0.266rem 0 rgba(0, 13, 79, 0.09);
            overflow: hidden;
        }

        #header .headerType {
            flex-grow: 1;

            font-size: 0.533rem;
            font-family: PingFangSC-Semibold;
            font-weight: 600;
            color: rgba(255, 255, 255, 1);
            text-align: center;
            line-height: 1.466rem;
            color: #9B9B9B;
        }

        #header .headerSelected {
            color: #ffffff;
            background: linear-gradient(315deg, rgba(4, 46, 253, 1) 0%, rgba(100, 124, 244, 1) 100%);
        }

        .content {
            -webkit-border-radius: 0.266rem;
            -moz-border-radius: 0.266rem;
            border-radius: 0.266rem;
            overflow: hidden;
            box-shadow: 0 0.1rem 0.266rem 0 rgba(0, 13, 79, 0.09);
        }

        .contentType {
            height: 1.466rem;
            background: rgba(246, 248, 250, 1);

            font-size: 0.533rem;
            font-family: PingFangSC-Semibold;
            font-weight: 600;
            color: rgba(0, 10, 58, 1);
            line-height: 1.466rem;
            text-align: center;
            position: relative;
        }

        .contentType img {
            width: 0.633rem;
            height: 0.633rem;
            position: absolute;
            top: 0.433rem;
            left: 7.166rem;
            transition: all 100ms linear 0s;
        }

        .imgRotate {
            -webkit-transform: rotate(180deg);
            -moz-transform: rotate(180deg);
            -ms-transform: rotate(180deg);
            -o-transform: rotate(180deg);
            transform: rotate(180deg);
        }

        .contentType .selectBox {
            display: none;
            position: absolute;
            top: 1.466rem;
            left: 0;
            right: 0;
            width: 5.366rem;
            /*height: 5rem;*/
            background:rgba(255,255,255,1);
            box-shadow: 0 0.1rem 0.266rem 0 rgba(0, 13, 79, 0.09);
            -webkit-border-radius: 0.266rem;
            -moz-border-radius: 0.266rem;
            border-radius: 0.266rem;
            overflow: hidden;
            margin: auto;
            z-index: 1;
        }

        .contentType .selectBox .selectBoxOption {
            width: 100%;
            height: 1.333rem;
            font-size:0.466rem;
            font-family:PingFangSC-Regular;
            font-weight:400;
            color:rgba(0,10,58,1);
            line-height:1.333rem;
        }

        .contentType .selectBox .contentTypeSelected {
            color: rgba(44, 79, 249, 1);
        }

        .chart {
            /*height: 13.333rem;*/
            height: 14.866rem;
            display: none;
        }
        .contentMain .chart:first-child {
            display: block;
        }

        #footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1;
        }

        .pageBtn {
            width: 2.166rem;
            height: 2.166rem;
        }

        #lastPage {
            position: absolute;
            left: 0.233rem;
            bottom: 0.666rem;
            background:url("img/lastPage.png");
            background-size: cover;
        }
        #nextPage {
            position: absolute;
            right: 0.233rem;
            bottom: 0.666rem;
            background: url("img/nextPage.png");
            background-size: cover;
        }
    </style>
</head>
<body>
<div id="header">
    <div class="headerType headerSelected">债券</div>
    <div class="headerType">权益</div>
    <div class="headerType">债权</div>
</div>

<div id="footer">
    <div id="lastPage" class="pageBtn"></div>
    <div id="nextPage" class="pageBtn"></div>
</div>

<div id="page1" class="page">
    <div class="content">
        <div class="contentType">
            <span class="contentTypeName">发行额度</span>
            <img src="img/contentTypeIcon.png" alt="">
            <div class="selectBox">
                <div class="selectBoxOption contentTypeSelected" data-ref="1">发行额度</div>
                <div class="selectBoxOption" data-ref="2">发行只数</div>
            </div>
        </div>
        <div class="contentMain">
            <div id="page1Chart" class="chart"></div>
        </div>
    </div>
</div>
<div id="page2" class="page">
    <div class="content">
        <div class="contentType">
            <span class="contentTypeName">主体评级</span>
            <img src="img/contentTypeIcon.png" alt="">
            <div class="selectBox">
                <div class="selectBoxOption contentTypeSelected" data-ref="1">主体评级</div>
                <!--<div class="selectBoxOption" data-ref="2"></div>-->
            </div>
        </div>
        <div class="contentMain">
            <div id="page2Chart" class="chart"></div>
        </div>
    </div>
</div>
<div id="page3" class="page">
    <div class="content" style="height: 1000px;"></div>
</div>
<script src="js/jquery.min.js"></script>
<script src="js/echarts.min.js"></script>
<script src="js/china.js"></script>
<script>

    window.location.href = '#page1';

    let pages = ['#page1', '#page2', '#page3'];

    window.onhashchange = function () {
        let hash = window.location.hash;
        let indexOf = pages.indexOf(hash);
        $('.page').eq(indexOf).css('display', 'block').siblings('.page').css('display', 'none');
        scroll(0, 0);
    };

    //移动端手势
    var startx, starty;

    //获得角度
    function getAngle(angx, angy) {
        return Math.atan2(angy, angx) * 180 / Math.PI;
    };

    //根据起点终点返回方向 1向上 2向下 3向左 4向右 0未滑动
    function getDirection(startx, starty, endx, endy) {
        var angx = endx - startx;
        var angy = endy - starty;
        var result = 0;

        //如果滑动距离太短
        if (Math.abs(angx) < 2 && Math.abs(angy) < 2) {
            return result;
        }

        var angle = getAngle(angx, angy);
        if (angle >= -135 && angle <= -45) {
            result = 1;
        } else if (angle > 45 && angle < 135) {
            result = 2;
        } else if ((angle >= 135 && angle <= 180) || (angle >= -180 && angle < -135)) {
            result = 3;
        } else if (angle >= -45 && angle <= 45) {
            result = 4;
        }

        return result;
    }

    //手指接触屏幕
    document.addEventListener("touchstart", function (e) {
        startx = e.touches[0].pageX;
        starty = e.touches[0].pageY;
    }, false);
    //手指离开屏幕
    document.addEventListener("touchend", function (e) {
        var endx, endy;
        endx = e.changedTouches[0].pageX;
        endy = e.changedTouches[0].pageY;
        var direction = getDirection(startx, starty, endx, endy);

        // let scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
        // let clientHeight = document.documentElement.clientHeight;
        // let bodyHeight = document.body.clientHeight;

        console.log(direction);
        switch (direction) {
            case 0:
                // alert("未滑动！");
                break;
            case 1:
                // alert("向上！");
                // alert('scrollTop:' + scrollTop + '\n' + 'clientHeight:' + clientHeight + '\n' + 'bodyHeight' + bodyHeight);
                // if (scrollTop + clientHeight >= bodyHeight) {
                //     nextPage();
                // }
                break;
            case 2:
                // alert("向下！");
                // alert('scrollTop:' + scrollTop + '\n' + 'clientHeight:' + clientHeight + '\n' + 'bodyHeight' + bodyHeight);
                // if (scrollTop <= 0) {
                //     lastPage();
                // }
                break;
            case 3:
                // alert("向左！");
                nextPage();
                break;
            case 4:
                // alert("向右！");
                lastPage();
                break;
            default:
        }
    }, false);

    //按钮翻页
    $('#lastPage').click(function () {
        lastPage();
    });

    $('#nextPage').click(function () {
        nextPage();
    });

    function lastPage() {
        let hash = window.location.hash;
        let indexOf = pages.indexOf(hash);
        if (indexOf !== 0) {
            window.location.href = pages[indexOf - 1];
        }
    }

    function nextPage() {
        let hash = window.location.hash;
        let indexOf = pages.indexOf(hash);
        if (indexOf + 1 !== pages.length) {
            window.location.href = pages[indexOf + 1];
        }
    }

    //顶部栏type点击事件
    $('#header').click(function (ev) {
        let event = window.event || ev;
        $(event.target).addClass('headerSelected').siblings().removeClass('headerSelected');
    });

    //二级type点击事件
    $('.contentType').click(function (ev) {

        //select动画效果
        $(this).find('.selectBox').stop().slideToggle(100);
        //图标动画
        let img = $(this).find('img');
        if(img.hasClass('imgRotate')){
            img.removeClass('imgRotate');
        }else{
            img.addClass('imgRotate');
        }

        //逻辑判断
        let event = window.event || ev;

        let option = $(event.target);
        if(option.hasClass('selectBoxOption')){
            option.addClass('contentTypeSelected').siblings().removeClass('contentTypeSelected');
            let optionName = option.text();
            let optionRef = option.data('ref');
            option.parents('.contentType').find('.contentTypeName').text(optionName);

            let charts = $(this).parents('.content').find('.chart');
            switch(charts[0].id){
                case 'page1Chart':
                    switch(optionRef){
                        case 1:
                            page1Chart.setOption(page1HeaderType1ContentType1Option);
                            break;
                        case 2:
                            page1Chart.setOption(page1HeaderType1ContentType2Option);
                            break;
                    }
                    break;
            }
        }
    });

    //柱状图
    let barOption = {
        tooltip: {
            trigger: 'axis',
            axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
            }
        },
        legend: {},
        grid: {
            left:0,
            right:'5%',
            top: '5%',
            bottom: '5%',
            containLabel: true //grid 区域是否包含坐标轴的刻度标签
        },
        xAxis: {
            show: true,
            type: 'category',
            data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
            axisLine: {
                show: false,
            },
            axisTick: {
                show: false
            },
            axisLabel: {
                show: true,
                color: 'rgba(32,32,32,1)',
                fontFamily: 'PingFangSC-Semibold',
                fontWeight: 600,
                fontSize: 10
            }
        },
        yAxis: {
            type: 'value',
            axisLine: {
                show: false,
            },
            axisTick: {
                show: false
            },
            axisLabel: {
                show: true,
                color: 'rgba(32,32,32,1)',
                fontFamily: 'PingFangSC-Semibold',
                fontWeight: 600,
                fontSize: 10
            }
        },
        color: ['#43DFFF', '#042EFD'],
        series: []
    };

    //数据渲染
    let page1Chart = echarts.init(document.getElementById('page1Chart'));

    let page1HeaderType1ContentType1Option = {...barOption};
    page1HeaderType1ContentType1Option.series = [
        {
            name: '发行',
            type: 'bar',
            data: [27099350, 20803000, 60303000, 57237500, 27220600, 30402900, 42606500, 54550500, 34185200, 39513401, 50447400, 45727978.4]
        },
        {
            name: '交易',
            type: 'bar',
            data: [27099350, 20803000, 60303000, 57237500, 27220600, 30402900, 42606500, 54550500, 34185200, 39513401, 50447400, 45727978.4]
        }
    ];

    let page1HeaderType1ContentType2Option = {...barOption};
    page1HeaderType1ContentType2Option.series = [
        {
            name: '发行',
            type: 'bar',
            data: [255, 179, 537, 547, 228, 245, 363, 500, 320, 370, 488, 436]
        },
        {
            name: '交易',
            type: 'bar',
            data: [255, 179, 537, 547, 228, 245, 363, 500, 320, 370, 488, 436]
        }
    ];

    page1Chart.setOption(page1HeaderType1ContentType1Option);

</script>
</body>
</html>