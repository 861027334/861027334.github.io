<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Title</title>
    <link rel="stylesheet" href="css/swiper.css">
    <style>
        *{
            padding: 0;
            margin: 0;
        }
        #nav {
            position: relative;
            height: 40px;
        }
        #nav .swiper-wrapper {
            display: flex;
        }
        #nav .swiper-slide {
            text-align: center;
            flex-grow: 1;
            width: auto;
            /*width: 0;*/
            /*width: 100px;*/
            white-space: nowrap;
            font-size: 20px;
            line-height: 40px;
            padding: 0 20px;
            box-sizing: border-box;
        }

        #nav #bar {
            /*width: 50px;*/
            height: 3px;
            position: absolute;
            bottom: 0;
        }
        #nav #bar .color {
            width: 50px;
            margin: 0 auto;
            height: 3px;
            background: #ff4891;
        }
    </style>
</head>
<body>
<div class="swiper-container" id="nav">
    <div class="swiper-wrapper">
        <div class="swiper-slide">首页</div>
        <div class="swiper-slide">购物栏</div>
        <div class="swiper-slide">设置选项</div>
        <div class="swiper-slide">测试很多的字</div>
        <!--<div class="swiper-slide">测试更多更多的字</div>-->
        <!--<div class="swiper-slide">测试更多更多的字</div>-->
        <!--<div class="swiper-slide">测试更多更多的字</div>-->
        <!--<div class="swiper-slide">在测试一下</div>-->
        <!--<div class="swiper-slide">我的</div>-->
        <div id="bar">
            <div class="color"></div>
        </div>
    </div>
</div>
<hr>
<div class="swiper-container" id="page">
    <div class="swiper-wrapper">
        <div class="swiper-slide">
            <div style="height: 2000px;background-color: #d2d2d2">Slide 1</div>
        </div>
        <div class="swiper-slide">
            <div style="height: 1000px;">Slide 2</div>
        </div>
        <div class="swiper-slide">
            <div style="height: 1000px;background-color: #d2d2d2">Slide 3</div>
        </div>
        <div class="swiper-slide">
            <div style="height: 3000px">Slide 4</div>
        </div>
        <!--<div class="swiper-slide">-->
            <!--<div style="height: 3000px">Slide 5</div>-->
        <!--</div>-->
        <!--<div class="swiper-slide">-->
            <!--<div style="height: 3000px">Slide 6</div>-->
        <!--</div>-->
        <!--<div class="swiper-slide">-->
            <!--<div style="height: 3000px">Slide 7</div>-->
        <!--</div>-->
        <!--<div class="swiper-slide">-->
            <!--<div style="height: 3000px">Slide 8</div>-->
        <!--</div>-->
        <!--<div class="swiper-slide">-->
            <!--<div style="height: 3000px">Slide 9</div>-->
        <!--</div>-->
    </div>
</div>

<script src="js/swiper.js"></script>
<script>

    let nav = document.getElementById('nav');
    let bar = document.getElementById('bar');
    let navClientWidth;
    let navWidth;
    let offsetLeft;

    let navSwiper = new Swiper(nav, {
        slidesPerView: 'auto',
        freeMode:true,
        // resistanceRatio: 0,
        on:{
            init:function () {
                let width = this.slides[0].clientWidth;
                navClientWidth = this.$el.clientWidth;
                bar.style.width = width + 'px';
                offsetLeft = this.slides[this.slides.length - 1].offsetLeft;

                navWidth = 0;
                for (let i = 0; i < this.slides.length; i++) {
                    navWidth += this.slides[i].clientWidth;
                }
            },
            updateProgress:function (num) {
                console.log(num);
            }
        }

    });

    let page = document.getElementById('page');
    new Swiper(page,{
        watchSlidesProgress: true,
        on: {
            touchMove:function () {
                let progress = this.progress;
                let active = navSwiper.slides[this.activeIndex];
                // let width = active.clientWidth;
                // bar.style.width = width + 'px';
                bar.style.transition = '0s';
                bar.style.transform = 'translateX(' + offsetLeft * progress + 'px)';

            },
            transitionStart:function () {
                let active = navSwiper.slides[this.activeIndex];
                let navActiveSlideLeft = active.offsetLeft;
                let width = active.clientWidth;
                bar.style.width = width + 'px';
                bar.style.transition = '300ms';
                bar.style.transform = 'translateX(' + navActiveSlideLeft + 'px)';

                navSwiper.setTransition(300);
                if (navActiveSlideLeft < (navClientWidth - width) / 2) {
                    navSwiper.setTranslate(0);
                    console.log(1);
                } else if (navActiveSlideLeft > navWidth - (width + navClientWidth) / 2) {
                    console.log(2);
                    navSwiper.setTranslate(navClientWidth - navWidth)
                } else {
                    console.log(3);
                    navSwiper.setTranslate((navClientWidth - width) / 2 - navActiveSlideLeft)
                    // navSwiper.setTranslate(0);
                }
            }
        }
    })
</script>
</body>
</html>